b'Ways to Improve Your Correlation Functions\n\nA. J. S. Hamilton\nJoint Institute for Laboratory Astrophysics\nand Department of Astrophysical, Planetary and Atmospheric Sciences\nUniversity of Colorado, Boulder\n\nABSTRACT. This paper describes a number of ways to improve on the standard\nmethod for measuring the two-point correlation function of large scale structure in the\nUniverse. Issues addressed are: (1) The problem of the mean density, and how to\nsolve it; (2) How to estimate the uncertainty in a measured correlation function; (3)\nMinimum variance pair weighting; (4) Unbiased estimation of the selection function\nwhen magnitudes are discrete; (5) Analytic computation of angular integrals in\nbackground pair counts.\n1. The Mean Density Problem\nIt is widely thought that the accuracy of the correlation function \xc2\xa3 is fundamentally\nlimited by uncertainty in the mean density. Actual, this notion is false (\xc2\xa71.2), although\nit is true for the commonly used estimator of \xc2\xa3 (\xc2\xa71.1).\n\n1.1 THE PROBLEM\nThe statistic commonly used to estimate % from a catalog of galaxies is (e.g. Davis and\nPeebles 1983)\n_ <NNxW>\n*\xc2\xabt- <NW><N>\nW\nwhere N represents real galaxies, W is the catalog window, and < > denotes averaging\nover all points in the catalog; for <NN> and <NW> the averaging is over all pairs\nlying in an interval of separations r. The observed galaxy density N is the true galaxy\ndensity n times the catalog window W (strictly, observed discrete galaxies are taken to\nbe a Poisson process superimposed on this). In terms of the true galaxy overdensity\n8 = (n - n ) / n , where n is the true mean galaxy density of the Universe, the observed\ngalaxy density N is\nN=nW(l+S) .\n(2)\nTo see how good the estimate (1) of_^ is in a realistically unfair sample,\nintroduce the following notations (3)-(5). Let 5 be the mean overdensity in the catalog\n(3)\n\n15\n\nand let y denote the galaxy-catalog correlation function\n\nIn a fair sample, the mean overdensity 5 and the galaxy-catalog correlation function iff\nwould be identically zero, but they are not necessarily zero in reality. Let | denote the\nwindowed galaxy-galaxy correlation function\n<W1S1 W262>\n\n<W,W 2 >\n\xe2\x80\xa2\nWhile ^ is not necessarily equal to the true correlation function ^ of the Universe, it is\nat least the \'true\' correlation function of the sample, which is presumably the next best\nthing.\nIn terms of 5, y, and |, the standard estimate (1) of the correlation function E, is\n/s\n\nThe problem with equation (6) is that it contains not-necessarily-vanishing terms\n\\ff(r)-S which are of first prder in overdensity 5, whereas the thing you want, the\nsample correlation function |, is of second order in 5. This is a severe drawback of\nthe estimator (1) for ^ in the linear regime of small 5.\n1.2 A SOLUTION, PART 1\nA better estimate of ^ is\n._ <NNxWW>\n"aest -\n\n_\n\nin which the brackets <> in both numerator and denominator denote averaging over\npairs in an interval of separations r. In terms of the galaxy-catalog correlation\nfunction y and the sample galaxy-galaxy correlation function | defined by equations\n(4) & (5), the estimate (7) is\n\nA\n\nwhich differs from the sample correlation function ^ only by terms which are of\nsecond order in overdensity 5.\nThe advantages of the estimator (7) over the standard estimator (1) for \xc2\xa3 are:\n(a) Accuracy, especially in the large scale, linear regime;\n(b) Reliability in the presence of unfairness, especially with not-unbiased (e.g.\nminimum variance, \xc2\xa73) pair weightings;\n(c) Peace of mind: there is no need to measure the mean density <N>/<W> as a\nseparate operation; equation (7) specifies that the \'correct\' mean density to use in\nplace of the <N>/<W> in equation (1) is <NW>2/<WW>, a quantity which it is\nto be noted varies with separation r .\n\n16\n\n1.3 SOLUTION, PART 2\nThe iff2 term in equation (8) represents large scale variance which is inevitably missing\nin a finite catalog; its presence is symptomatic of the familiar problem that using the\nsample mean leads to an underestimate of the sample variance. Although the galaxycatalog correlation \\y should be zero in the mean over many samples, its variance\n<i^2> should be positive in the mean. Physically, <i//2> represents the mean fractional\nexcess of galaxies clustered around a galaxy on the scale of the catalog. If one\nimagines evaluating the correlation function by sitting on galaxies and counting\nneighbors, the mean density at infinity should be determined not from the total number\nof galaxies in the catalog volume, but rather from the number of galaxies less the\nmean excess of galaxies clustered around a galaxy.\nOne way to correct for the missing variance is to use an alternate estimator\n_\n<NNxWW>\n?est\n()\n<AW> 2 -<A(AW) 2 >\nwhich in terms of | and iff and its variance <\\y2> is\n\n.\nThe variance <A(AW)2> in equation (9) may be computed from the fluctuations in\n<AW>, using methods similar to those described in \xc2\xa72. Another way to correct for\nmissing large scale variance is given by Hamilton (1993).\n2. Estimating Errors in the Correlation Function\n2.1 MATHEMATICS\n\nThe window W can be imagined as a set of weights Wt attached to every tiny volume\nelement of the Universe. For an observed subsample, the weights Wi are nonzero only\nover the observed region. For the entire population, the Universe, the weights W i<pop\nare finite everywhere, but infinitesimal compared to the sample weights W,-.\nThe correlation function \xc2\xa3(Wj) measured in a sample differs from the true\ncorrelation function ^(Wf ipop) by an error A^\nExpanding the error A| as a Taylor series to second order in the weights gives\n\n.(12)\npop\n\n\xe2\x80\xa2\xc2\xab\xe2\x80\xa2 ij\n\n. "\n\n\xe2\x80\xa2"\n\nOYVfOWj\n\npop\n\nUsing the facts that (a) \xc2\xa3(W,.) is unchanged by rescaling W} \xe2\x80\x94\xc2\xbbAW,-, (b) \xc2\xa7 is a\nquadratic function of the weights Wt (at least for the estimator [7]), and (c) W^ ^ is\ninfinitesimal compared to Wit eliminates most of the terms, in equation .(12), reducing\nit to\n\n^\n\n=\n\n(13)\n\nf f\n\npop\n\nwhich then reduces further to\n\n17\n\n(14)\npop\n\ndistinct ij\n\nwhere W^ =W t Wj. Expression (14) makes clear the fact that the error A| is truly a\nderivative with respect to pairs. Approximating the population derivative of ^ in (14)\nby the sample derivative, and again using the fact that ^(W f ) is quadratic in Wf,\npermits equation (14) to be rearranged as a sum over volume elements i rather than\npairs ij:\nA\xc2\xa3=\xc2\xa3A\xc2\xa3,.\n\nwith\n\nA\xc2\xa7.\n\n=lnr.JL\n\n.\n\n(15)\n\nNote the important factor of */2 in equation (15), which in effect causes pairs to be\ncounted once, not twice. The variance of E, is then\n<A^2> = ZA^-A^. .\n(16)\nij\n\nCharacteristically, the variance (16) increases as pairs ij of greater and greater\nseparation are included, reaches a maximum, then declines to exactly zero when all\npairs are included. The declining to zero is a consequence of approximating the\npopulation derivatives of t; with the sample derivatives of \xc2\xa3. To solve the problem,\nonly pairs ij separated by some finite distance should be included.\nFor the estimator (7), the contribution A\xc2\xa3,- to the error in \xc2\xa3 from volume element\ni is\n<NWf>\n= (1 + lest)\n\n<NN>\n\n<NW>\n\n<NW>\n\n<WW>\n\n(17)\n\n2.2 SUGGESTED STEP-BY-STEP ERROR ANALYSIS\n(a) Divide the catalog into many subregions /.\n(b) Estimate \xc2\xa3 from equation (7), and compute A\xc2\xa3,- for each subregion from equation\n(17).\n(c) Compute the variance <A|2> from equation (16), including pairs ij of subregions\nof greater and greater separation, until the variance reaches a maximum.\n(d) The 1-sigma error in \xc2\xa3 is the square root of this variance.\n3. Minimum Variance Pair Weighting\n\n3.1 MATHEMATICS\nAn unbiased estimate of the correlation function | is gotten in principle by weighting\neach point inversely with the selection function O at the point, so that all volume\nelements count equally. Unfortunately this leads to a noisy estimate of t; from regions\nwhere the selection function O is small. To the extent that the selection function is\nuncorrelated with the true galaxy density, the most accurate estimate of % is obtained\nby reweighting the unbiased weighting of pairs inversely with the variance <A\xc2\xa32> of \xc2\xa3,\nso that a (real or background) pair 12 is weighted\n\n(18)\n\n18\n\nIf the only source of uncertainty in ^ comes from the fact that the sample is a finite\nsubset of the Universe, then the expected covariance between <^\'s at separations r12\nand r34 is\n<A<*12A\xc2\xa334> = <51525354\n~ J (\xc2\xa313^24\n\n+ H 1234) ^3\n\n(19)\n\nthe integral being carried over all possible separations of point 3 from point 1. An\nimportant point to notice is that the ^\'s in the integrand of (19) have delta functions at\nzero separation, because of the discreteness of galaxies. These delta functions cause\nequation (19) to take the general form\n<A\xc2\xa32> oc or2 + 2O-1/ + K\n(20)\nin a region where the selection function is O. The <X>~2 term in equation (20) comes\nthe case where pairs 12 and 34 coincide, the O"1 term from cases where 12 and 34\nshare a point in common, and the constant term from cases where 12 and 34 are\ndisjoint pairs. Equation (20) yields the pair weighting\n\nw12= -- - .\n1 + 2O/ + K$>2\n\n(21)\n\nGenerally one is interested not in ^ at some precise separation, but rather\naveraged over some range of separations; or one might be interested in the power\nspectrum, or the harmonics of <\xc2\xa3, or such like. In that case equation (19) should be\nintegrated with the desired kernel functions over the desired ranges of separations.\nThe result is again equations of the form (20) and (21), but with different values of the\ncoefficients / and K . The bad news is that a calculation of / and K from equation\n(19) is generally tricky and uncertain, and in any case suspect because an\nobservationally measured \xc2\xa3 may be subject to other sources of uncertainty ignored in\nequation (19). The good news is, the calculation is unnecessary. A practical solution\nis to proceed empirically, using the form (21) as a template for an approximate pair\nweighting, the free parameters of which would be determined empirically by\nminimizing the observed variance <A^2> computed for example using the method of\n\xc2\xa72. This is the approach suggested in \xc2\xa73.2 below.\n\n3.2 SUGGESTED NEAR MINIMUM VARIANCE WEIGHTING\nA simple approximation to the minimum variance pair weighting which should not be\ntoo bad in practice would be to weight every (real and background) pair 12 by\nw12 = w 1 w 2 , the weight w,- at each point i where the selection function is O, being\n\n"i-TW\n\n\xe2\x80\xa2\n\n<22)\n\nThe quantity / in equation (22) is likely to be different for different pair separations r .\nConsideration of the behavior of the integral (19) suggests that a reasonable guess\nwould be to take\nJ =Crc\n(23)\nwith c ~ 3 ~ Y if \xc2\xa3oc r~r- The free parameters C and c in (23) would be determined\nempirically by varying them until the computed variance <A^2> of \xc2\xa3, or of whatever\nintegral over \xc2\xa3 is the quantity of interest, is minimized. Clearly the approximation\n(23), and perhaps also (22), could be refined if deemed necessary.\n\n19\n\n4. The Selection Function and the Discreteness of Magnitudes\n\n4.1 PROBLEM\nTurner\'s (1979) classic inhomogeneity-insensitive method of measuring the selection\nfunction is found empirically to be sensitive to bin size.\n\n4.2 DIAGNOSIS\nStrauss, Yahil & Davis (1991) correctly attribute the sensitivity of Turner\'s method to\nbin size to the fact that magnitudes given in catalogs are discretely, not continuously,\ndistributed.\nThe periodicity of listed magnitudes (e.g. Zwicky gives magnitudes mostly to 0.1)\ntranslates into a periodic ripple in the derived selection function (with period 0.1\nmagnitudes in Zwicky\'s case).\n\n4.3 SOLUTION\nThe fix is simple: just choose a bin size equal to the period (0.1 magnitudes in\nZwicky\'s case), so the periodic ripple has no effect. Note that the worst possible\nbinning is exactly half a period, since successive samplings of the selection function\nare then maximally out of phase.\n5. Better Backgrounds\nOftentimes a catalog window is the product of a radial selection function and an\nangular window which is one inside, zero outside, a boundary composed of a set of arc\nsegments. Angular integrals in such a case can be done analytically, and backgrounds\ncan then be integrated quickly and accurately.\n[At the conference, a binder was exhibited containing listings of Fortran code to\ncompute angular integrals analytically. The relevant mathematics is given by Hamilton\n(1993, Appendix).]\nReferences\nDavis, M., & Peebles, P. J. E. 1983, ApJ 267, 465.\nHamilton, A. J. S. 1993, ApJ, submitted.\nStrauss, M. A., Yahil, A., & Davis, M. 1991, PASP, 103, 1012.\nTurner, E. L. 1979, ApJ, 231, 645.\n\n20\n\n'