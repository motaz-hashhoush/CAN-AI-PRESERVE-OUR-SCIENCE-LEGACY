b'NASA NIFS \xe2\x80\x93 Internship Final Report\n\nSimscape Modeling of a Custom Closed-Volume Tank\nNathaniel P. Fischer\nKennedy Space Center\nMajor: Mechanical Engineering\nKSC Spring Session\nDate: 1 April 2015\n\nNASA Kennedy Space Center\n\nP age |1\n\n27 March 2015\n\nNASA NIFS \xe2\x80\x93 Internship Final Report\n\nSimscape Modeling of a Custom Closed-Volume Tank\nNathaniel P. Fischer\nUniversity of Wisconsin-Platteville, Platteville, WI, 53818\n\nThe library for Mathworks\xc2\xae Simscape\xe2\x84\xa2 does not currently contain a model for a closedvolume fluid tank where the ullage pressure is variable. In order to model a closed-volume\nvariable ullage pressure tank, it was necessary to consider at least two separate cases: a\nvertical cylinder, and a sphere. Using library components, it was possible to construct a rough\nmodel for the cylindrical tank. It was not possible to construct a model for a spherical tank,\nusing library components, due to the variable area. It was decided that, for these cases, it\nwould be preferable to create a custom library component to represent each case, using the\nSimscape language. Once completed, the components were added to models, where filling and\ndraining the tanks could be simulated. When the models were performing as expected, it was\nnecessary to generate code from the models and run them in Trick (a real-time simulation\nprogram). The data output from Trick was then compared to the output from Simscape and\nfound to be within acceptable limits.\n\nNomenclature\nP\nk\nr\nd\nA\nP0\nm\ncp\nV0\nVf\nVt\nAs\ndt\n\n=\n=\n=\n=\n=\n=\n=\n=\n=\n=\n=\n=\n=\n=\nh0\n=\n=\nhf\nht\n=\ndVf/dt\n=\nT0\n=\nT\n=\nQ\n=\nKSC\n=\nNASA\n=\nSimscape =\nCSV\n=\n\npressure\nspecific heat ratio of gas\ntank radius\ndiameter\narea\ninitial pressure\nmass\nconstant pressure specific heat\ninitial volume of fluid\nvolume of fluid at time t\nvolume of tank\nsurface area\ntime step\nfluid density\ninitial fluid height\nheight of fluid at time t\nheight of tank\nfluid flow rate\ninitial temperature\ntemperature\nheat flow\nKennedy Space Center\nNational Aeronautic and Space Administration\nMathWorks\xc2\xae Simscape\xe2\x84\xa2\nComma-Separated Value\n\nSimulation Intern, NE-C1, Kennedy Space Center, University of Wisconsin-Platteville.\n\nNASA Kennedy Space Center\n\nP age |2\n\n27 March 2015\n\nNASA NIFS \xe2\x80\x93 Internship Final Report\n\nI. Introduction\nathWorks\xc2\xae Simscape\xe2\x84\xa2 (Simscape), is modeling and simulation software that can be used to represent a variety\nof physical systems. The National Aeronautic and Space Administration (NASA) is investigating further use of\nSimscape by the Application & Simulation Software Engineering Branch, NE-C1, at Kennedy Space Center (KSC).\nSimscape models must be proven to be capable of running in real-time, using Trick (a real-time simulation program),\nand with an acceptable level of accuracy. I have been tasked with creating a functional model of a fluid tank, where\nthe gas pressure inside of the tank will increase or decrease with a corresponding change in liquid volume. There are\ntwo major tank geometries that will be considered for this model: a vertical cylinder, and a sphere.\n\nM\n\nII. Simscape Components and Models\nA. Requirements\n1. The component should have one liquid inlet/outlet, located at the bottom.\n2. The tank pressure should vary with changes in the liquid volume.\n3. The component should account for heat transfer between the tank and the liquid in the tank.\n4. The component will be considered to be well insulated, so the heat transfer effects with the environment will\nbe assumed to be negligible.\n\nB. Rough Model\nIn order to have a basis for\ncomparison, I constructed a model\nthat is representative of a\ncylindrical tank, using Simscape\nlibrary components. It uses a\nhydraulic cylinder that is physically\nconnected to a pneumatic cylinder\nthrough the piston rods of the\ncylinders. When using this model, if\nthe dimensions of the tank need to\nbe changed, the changes have to be\nincorporated into both cylinders,\nthis is more time consuming and\ncould introduce the possibility for\nerrors. Additionally, the thermal\nport on the pneumatic cylinder is\nmeant to interact with the gas, and I\nam more interested in the heat Figure 1. Image of rough Simscape model.\ntransfer between the liquid and the\ntank.\n\nC. Custom Cylindrical Tank Component\nUsing the Simscape language, it is possible to modify some library components, or, to\ncreate complete custom components. In order to satisfy the requirements for the fluid tank,\nI decided to start from the beginning. To simplify the equations, I made certain reasonable\nassumptions: The gas in the tank is assumed to be an ideal gas, temperature change of the\ngas due to volume change (compression or expansion), is considered to be negligible, heat\ntransfer between the gas and liquid is considered to be negligible, the tank is considered to\nbe well insulated, change of tank volume due to pressure change is not considered. The\nport labels for the component require some clarification. H is the hydraulic port, where Figure 2. Image of custom\nthe fluid flows into or out of the tank. A is a physical signal port that outputs the contact Simscape cylindrical tank\nsurface area between the tank and the fluid, it is used with the custom heat transfer component.\n\nNASA Kennedy Space Center\n\nP age |3\n\n27 March 2015\n\nNASA NIFS \xe2\x80\x93 Internship Final Report\n\ncomponents during simulation. V is a physical signal port that outputs the fluid volume. T is a thermal port that is\nused to model the heat transfer, between the tank and the fluid in the tank. P is a physical signal port that outputs the\npressure in the tank. M is a physical signal port that outputs the fluid mass, and it is used with the custom thermal\nmass component to model heat transfer. Temp is a physical signal port that outputs the fluid temperature.\nD. Cylindrical Tank Equations\nThe following equations were used to create the cylindrical tank component.\n(1)\n(2)\n\n(3)\n\n(4)\n(5)\n(6)\n(7)\n\nE. Testing Custom Tank Models\nIn order to verify the functionality of\nthe custom tank components, they were\nadded to a model, where the interaction\nwith other components could be tested\nand verified. In the model, the \xe2\x80\x9cVariable\nHead Tank\xe2\x80\x9d supplies the fluid, and the\n\xe2\x80\x9cHydraulic Constant Pressure Source\xe2\x80\x9d\nprovides the pressure to initiate flow.\nHeat transfer in the tank component is\nmodeled through the thermal port \xe2\x80\x9cT\xe2\x80\x9d, the\nthermal mass associated with the fluid in\nthe tank is represented by \xe2\x80\x9cThermal\nMass\xe2\x80\x9d, and the thermal mass of the tank is\nrepresented by \xe2\x80\x9cTank Mass\xe2\x80\x9d. The heat\ntransfer between the tank and the fluid is\nrepresented by the \xe2\x80\x9cConvective Heat\nTransfer\xe2\x80\x9d and \xe2\x80\x9cConductive Heat\nTransfer\xe2\x80\x9d components.\nFigure 3. Image of custom cylindrical tank model (spherical model similar).\n\nF. Custom Spherical Tank Component\nThe assumptions for the spherical tank are the same as the assumptions listed for the\ncylindrical tank. In order to represent the relationship between the area change and the\nheight change of the fluid, it was necessary to develop this component from the\nbeginning, using the Simscape language. The inputs and outputs for this tank are similar\nto those found on the cylindrical tank, described in section (II.C).\n\nFigure 4. Image of custom spherical\ntank Simscape component.\n\nNASA Kennedy Space Center\n\nP age |4\n\n27 March 2015\n\nNASA NIFS \xe2\x80\x93 Internship Final Report\n\nG. Spherical Tank Equations\nThe following equations were used to create the spherical tank component. The derivations for the volume and\narea equations are in the Appendix.\n(8)\n\n(9)\n\n(10)1\n\n(11)\n(12)\n\n(13)2\n(14)\n\n(15)\n(16)\n\nH. Custom Library\nAfter writing the code for the\ncomponents in Simscape language, it is\nnecessary to save them in a separate folder.\nIn order to be considered as a Simscape\nlibrary, this folder must begin with a \xe2\x80\x9c+\xe2\x80\x9d, so,\nan example would be: +Folder_name, I\nwould suggest adding this directory to the\nMatlab path. From the Matlab command\nline, the command to compile and build the\ncomponents in the library folder is: ssc_build\nFolder_name. If there are no errors in the\nSimscape code files, the library should\nresemble Fig. 3. The default image for a\ncustom Simscape component is a labeled box\nwith the corresponding inputs and outputs. If\na different image is desirable, it is relatively\nsimple to add. Save a copy of the image in\nthe \xe2\x80\x9c+Folder_name\xe2\x80\x9d directory. The file name\nfor the image has to match the file name of Figure 5. Image of custom component library.\nthe component, for example: for the\nSimscape file, \xe2\x80\x9ccustom_file.ssc\xe2\x80\x9d the image would need to be \xe2\x80\x9ccustom_file.img\xe2\x80\x9d, where img is a supported file format\nfor the image. The supported image file formats are: jpg, bmp, and png 3.\n\nNASA Kennedy Space Center\n\nP age |5\n\n27 March 2015\n\nNASA NIFS \xe2\x80\x93 Internship Final Report\n\nI. Additional Custom Components\nWhen attempting to model the heat transfer between the fluid and the tank walls, I found that the standard library\ncomponents were missing some necessary functionality. In the \xe2\x80\x9cThermal Mass\xe2\x80\x9d standard library component, the mass\nis a fixed parameter that cannot easily be adjusted during simulation. For the tank components, the fluid mass is\nchanging continuously with fluid volume. In order to consider the change in mass, I modified the standard \xe2\x80\x9cThermal\nMass\xe2\x80\x9d component to accept the value for mass as a physical signal input. Also, both tank components were modified\nto output the fluid mass as a physical signal. A similar problem was encountered with the heat transfer library\ncomponents (Conductive Heat Transfer and Convective Heat Transfer), where the area is a fixed parameter. The\nsurface area of the liquid that contacts the tank changes continuously with fluid volume as well. A similar solution\nwas employed to account for the changing area, the heat transfer components were modified to accept the area as a\nphysical signal input, and the tank components were modified to output the area as a physical signal.\n\nIII. Verification of Models\nA. Cylindrical Tank Comparison\nThe cylindrical tank component was incorporated into a model, similar to the model shown in Fig. 3. The\nsimulation was run, and the results were recorded. This procedure was repeated for the rough model, shown in Fig. 1.\nNext, some of the results from the two simulations were plotted and compared, shown in Fig. 6 and 7.\n\nFigure 6. Pressure as a function of time.\n\nFigure 7. Fluid flow rate as a function of time.\n\nI then compared the two simulations, using the \xe2\x80\x9cSimulation Data Inspector\xe2\x80\x9d in Simscape, the results are shown in Fig.\n8. The two runs match each other closely, the Tank Volume curves are within 0.09%, the Pressure curves are within\n2.26%, and the Flow curves are within 1.78%.\nB. Code Generation\nAfter comparing the two models and finding the results to be satisfactory, the next step is to generate code from\nthe Simscape model, so it can be run in the Trick real-time simulation environment. The results from the Trick\nsimulation will then be compared to the results from the Simscape simulation, to determine if any variation exists\nbetween the two simulations. Also, it is important that the model is \xe2\x80\x9creal-time capable\xe2\x80\x9d, meaning that the computations\nperformed during one second of simulation time must take less than one second of real-time to complete.\nCertain configuration parameters in Simscape must be set before code generation can be done. I saved a copy of\nthe model onto the \xe2\x80\x9cKSC Template\xe2\x80\x9d, where the parameters were already set to the required values. I then ran the\nsimulation to verify that it would\ncompile and run with the new settings.\nIn the Simscape model, I replaced all\nof the Scopes with output ports, and\nused Pulse Generators to generate an\ninput signal. Using Matlab Coder, as a\ntest, I was able to successfully generate Figure 8. Comparison of simulation runs.\nC++ code from the model. In order to\n\nNASA Kennedy Space Center\n\nP age |6\n\n27 March 2015\n\nNASA NIFS \xe2\x80\x93 Internship Final Report\n\ngenerate all of the necessary files to run the simulation in Trick, a series of steps must be taken. First, I ran\nsim_mc_buildScript with the appropriate command line arguments and file paths, from a terminal. If there were any\nerrors in the build, I addressed them, and repeated the command until the build was successful. Next, I created a\ndata_logging.txt file with input and output names that matched the model inputs and outputs, using the\nSubsystem_Test_Bench Excel template. I then saved a copy of the data_logging.txt file into file_path/SIM/data. Next,\nI included the data_logging.txt file in the header of file_path/SIM/RUN/input. I ran the sim_tcid_buildScript with the\nappropriate command line arguments from a terminal, if any errors appeared, I addressed the errors and repeated until\nthe script ran successfully. I verified that an S_main_operatingsystem.exe file existed in the file_path/SIM directory.\nTo run the simulation in Trick, I changed directory to file_path/SIM. The next step was to run the\nS_main_operatingsystem.exe file\nwith argument RUN/input. Using\nCtrl Z to stop the command, and\nthen typed \xe2\x80\x9cbg\xe2\x80\x9d (to move the\nprogram to the background). I\nopened the Trick simulation control\nby typing: sim_control.tcl \xe2\x80\x93m\nmachine host name \xe2\x80\x93port number.\nThe Trick control panel opened\nwith the simulation paused. I ran the\nsimulation for a sufficient time to\ngather the necessary data. Once the\nsimulation was complete, there was\na log_filename.trk file in the\nfile_path/SIM/RUN directory. I\nconverted this file to a commaseparated value (CSV) file, using\nthe command trk2csv with the\nappropriate arguments4. Next, I\nimported the CSV data and\ncompared it to data that was saved\nfrom a Simscape simulation, using Figure 9. Comparison of Simscape data and Trick data.\nMatlab to plot the results.\nAs shown in Fig. 9, the data from the Trick simulation overlays the plot from the Simscape simulation exactly.\nThe results shown are from the cylindrical tank model, the results from the spherical tank model were similar when\nthe simulations were compared.\n\nIV. Conclusion\nWhen comparing the custom cylindrical tank to the one provided Simscape library components, the results are\npromising. Unfortunately, I have no rough Simscape model to compare the custom spherical tank model against, to\nverify the accuracy of the model, other than the equations that define the tank geometry, though the model performs\nas expected. When the need arises, The use of the Simscape language to create custom components, or to extend\nexisting Simscape library components is straight forward, feasible and recommended.\n\nNASA Kennedy Space Center\n\nP age |7\n\n27 March 2015\n\nNASA NIFS \xe2\x80\x93 Internship Final Report\n\nAppendix\nDerivation of Spherical Tank equations:\n,\nOr\n\nWhere r(h) is the radius of the fluid level at height h and R is the tank radius.\nSo, the volume would be:\n,\nWhere\n\nAcknowledgments\nI would like to thank my mentor, Lien Moore, for offering me this amazing, once in a lifetime opportunity. Also,\nI would like to thank Adam Ayer, who was very helpful in getting me set up with accounts and initial training.\nAdditionally, Mike Waldorf was very helpful when I had issues with code generation and Trick questions. Last but\nnot least, I would like to thank my family for their support and encouragement. This entire experience has been\nchallenging in all of the right ways, and I feel as though I have learned so much in such a short time.\n\nReferences\n\xe2\x80\x9cFluid Level in a Spherical Tank,\xe2\x80\x9d URL: http://spacemath.gsfc.nasa.gov/Calculus/5Page45.pdf [cited 2 April 2015].\n\xe2\x80\x9cFluid Level in a Spherical Tank,\xe2\x80\x9d URL: http://spacemath.gsfc.nasa.gov/Calculus/5Page45.pdf [cited 2 April 2015].\n3\n\xe2\x80\x9cBuild\ncustom\nlibrary\nfrom\ncollection\nof\nSimscape\nfiles,\xe2\x80\x9d\nURL:\nhttp://www.mathworks.com/help/physmod/simscape/ref/ssc_build.html [cited 2 April 2015].\n1\n2\n\n4\n\n\xe2\x80\x9cTrick User\xe2\x80\x99s Guide\xe2\x80\x9d, November 1, 2009.\n\nNASA Kennedy Space Center\n\nP age |8\n\n27 March 2015\n\n'